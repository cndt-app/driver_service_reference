# Driver Service Reference

## Глоссарий

* **Partner API** - внешнее API представляющее статистические данные, с которым работает Драйвер.
* **Driver** - сервис, который реализует стандартизированный API для интеграции с Partner API.
* **Авторизационные данные** - данные (например логин и пароль), необходимые для авторизации запросов в Partner API.
* **Аккаунт** - сущность в Partner API позволяющая получить доступ к статистическим данным по Авторизационным данным.
  Некоторые Partner API предполагают наличие многих Аккаунтов (пример Facebook - Ad Accounts), некоторые не предполагают
  их наличие совсем (пример Shopify - там всегда один магазин), а в некоторых Аккаунтом может выступать сгенерированная
  сущность (например для запроса аналитической статистики нужно передать сайт+конкретный отчет - в таком случае Драйвер
  может генерировать Аккаунты из набора сайт+отчет).

## Driver’s API

Драйвер должен реализовать 4 метода:

* **/info**
* **/accounts**
* **/check**
* **/stats**

### Авторизация запросов

Методы, за исключением **/info** должны ожидать передачи авторизационных данных.

Авторизационные данные будут передаваться в хедерах при вызове API драйвера, для дальнейшей авторизации в Partner API.

***Строжайшим образом запрещается логировать, сохранять, и передавать куда-либо Авторизационные данные.***

При реализации драйвера, нужно выбрать один из способов авторизации в Partner API:

* **Login & password**
* **Token**

**Login & Password** - в случае этого типа авторизации Авторизационные данные будут передаваться 2 хэдерами:

* Authorization-Login
* Authorization-Password

**Token** - в случае этого типа авторизации Авторизационные данные будут передаваться одним хэдером:

* Authorization-Token

### API /info

Метод возвращает базовую информацию о драйвере и поддерживаемом методе передачи Авторизационных данных.

```
GET /info
Request body - empty
Response - JSON
{
  "name": str,  # Название Драйвера. Не должно меняться  
  "slug": str,  # [a-z_] Техническое название Драйвера. Не должно меняться. 
  "auth_type": str ENUM [ "login", "token" ] 
}
```

### API /accounts

Метод возвращает базовую информацию из Partner API идентифицирующую авторизационные данные, а также доступные Аккаунты.

```
POST /accounts
Auth Required
Request body - empty
Response - JSON
{
  "name": "John Doe"
  "native_id": "a329312c9cd",
  
  "accounts": [
    {
      "name": "Sneakers Shop",  
      "native_id": "b3933793c1cd",  
    },
    {
      "name": "Auto Parts Shop",  
      "native_id": "120aee9af4a0d",  
    },
  ]
}
```

### API /check

Выполняет проверку доступа к аккаунту

```
POST /check
Auth Required
Request body - JSON
{
  "native_id": str # account native id 
}

Response - HTTP OK or HTTP ERROR
```

### API /stats

Возвращает статистику в согласованном формате с набором определенных полей итд

```
POST /stats
Auth Required
Request body - JSON
{
  "date": str, # iso date string
  "native_id": str, # account native id 
}
Response - JSON
[
  {...},
  {...},
]
```
